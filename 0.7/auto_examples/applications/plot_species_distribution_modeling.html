

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Species distribution modeling &mdash; scikits.learn 0.7.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="scikits.learn 0.7.1 documentation" href="../../index.html" />
    <link rel="up" title="Examples" href="../index.html" />
    <link rel="next" title="Finding structure in the stock market" href="stock_market.html" />
    <link rel="prev" title="Faces recognition example using eigenfaces and SVMs" href="plot_face_recognition.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../index.html">
            <img src="../../_static/scikit-learn-logo-small.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../install.html">Download</a></li>
            <li><a href="../../support.html">Support</a></li>
            <li><a href="../../user_guide.html">User Guide</a></li>
            <li><a href="../index.html">Examples</a></li>
            <li><a href="../../developers/index.html">Development</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
  google.load('search', '1', {language : 'en'});
  google.setOnLoadCallback(function() {
    var customSearchControl = new google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    var options = new google.search.DrawOptions();
    options.setAutoComplete(true);
    customSearchControl.draw('cse', options);
  }, true);
</script>

</div>

          </div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

    <!-- <div id="blue_tile"></div> -->

        <div class="sphinxsidebar">
        <div class="rel">
          <a href="plot_face_recognition.html" title="Faces recognition example using eigenfaces and SVMs"
             accesskey="P">previous</a> |
          <a href="stock_market.html" title="Finding structure in the stock market"
             accesskey="N">next</a> |
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
        

        <h3>Contents</h3>
         <ul>
<li><a class="reference internal" href="#">Species distribution modeling</a></li>
</ul>


        

        </div>

      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="species-distribution-modeling">
<span id="example-applications-plot-species-distribution-modeling-py"></span><h1>Species distribution modeling<a class="headerlink" href="#species-distribution-modeling" title="Permalink to this headline">Â¶</a></h1>
<p>Modeling species&#8217; geographic distributions is an important
problem in conservation biology. In this example we
model the geographic distribution of two south american
mammals given past observations and 14 environmental
variables. Since we have only positive examples (there are
no unsuccessful observations), we cast this problem as a
density estimation problem and use the <cite>OneClassSVM</cite> provided
by the package <cite>scikits.learn.svm</cite> as our modeling tool.
The dataset is provided by Phillips et. al. (2006).
If available, the example uses <a class="reference external" href="http://matplotlib.sourceforge.net/basemap/doc/html/">basemap</a>
to plot the coast lines and national boundaries of South America.</p>
<p>The two species are:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.iucnredlist.org/apps/redlist/details/3038/0">Bradypus variegatus</a> ,
the Brown-throated Sloth.</li>
<li><a class="reference external" href="http://www.iucnredlist.org/apps/redlist/details/13408/0">Microryzomys minutus</a> ,
also known as the Forest Small Rice Rat, a rodent that lives in Peru,
Colombia, Ecuador, Peru, and Venezuela.</li>
</ul>
</div></blockquote>
<p>References:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.cs.princeton.edu/~schapire/papers/ecolmod.pdf">&#8220;Maximum entropy modeling of species geographic distributions&#8221;</a>
S. J. Phillips, R. P. Anderson, R. E. Schapire - Ecological Modelling,
190:231-259, 2006.</li>
</ul>
</div></blockquote>
<img alt="../../_images/plot_species_distribution_modeling.png" class="align-center" src="../../_images/plot_species_distribution_modeling.png" />
<p><strong>Python source code:</strong> <a class="reference download internal" href="../../_downloads/plot_species_distribution_modeling.py"><tt class="xref download docutils literal"><span class="pre">plot_species_distribution_modeling.py</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="c"># Author: Peter Prettenhofer &lt;peter.prettenhofer@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># License: Simplified BSD</span>

<span class="k">print</span> <span class="n">__doc__</span>

<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
    <span class="n">basemap</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">basemap</span> <span class="o">=</span> <span class="bp">False</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">exists</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">scikits.learn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="kn">from</span> <span class="nn">scikits.learn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="nn">scikits.learn.datasets.base</span> <span class="kn">import</span> <span class="n">Bunch</span>

<span class="c">################################################################################</span>
<span class="c"># Download the data, if not already on disk</span>
<span class="n">samples_url</span> <span class="o">=</span> <span class="s">&quot;http://www.cs.princeton.edu/~schapire/maxent/datasets/&quot;</span> \
              <span class="s">&quot;samples.zip&quot;</span>
<span class="n">coverage_url</span> <span class="o">=</span> <span class="s">&quot;http://www.cs.princeton.edu/~schapire/maxent/datasets/&quot;</span> \
               <span class="s">&quot;coverages.zip&quot;</span>
<span class="n">samples_archive_name</span> <span class="o">=</span> <span class="s">&quot;samples.zip&quot;</span>
<span class="n">coverage_archive_name</span> <span class="o">=</span> <span class="s">&quot;coverages.zip&quot;</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">archive_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">archive_name</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">urllib</span>
            <span class="k">print</span> <span class="s">&quot;Downloading data, please wait ...&quot;</span>
            <span class="k">print</span> <span class="n">url</span>
            <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">opener</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">print</span>

        <span class="kn">import</span> <span class="nn">zipfile</span>
        <span class="k">print</span> <span class="s">&quot;Decompressiong the archive: &quot;</span> <span class="o">+</span> <span class="n">archive_name</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">archive_name</span><span class="p">)</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
        <span class="k">print</span>


<span class="n">download</span><span class="p">(</span><span class="n">samples_url</span><span class="p">,</span> <span class="n">samples_archive_name</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="n">coverage_url</span><span class="p">,</span> <span class="n">coverage_archive_name</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>



<span class="c">################################################################################</span>
<span class="c"># Preprocess data</span>

<span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;bradypus_variegatus_0&quot;</span><span class="p">,</span> <span class="s">&quot;microryzomys_minutus_0&quot;</span><span class="p">]</span>
<span class="n">species_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">)])</span>

<span class="c"># x,y coordinates of study area</span>
<span class="n">x_left_lower_corner</span> <span class="o">=</span> <span class="o">-</span><span class="mf">94.8</span>
<span class="n">y_left_lower_corner</span> <span class="o">=</span> <span class="o">-</span><span class="mf">56.05</span>
<span class="n">n_cols</span> <span class="o">=</span> <span class="mi">1212</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">1592</span>
<span class="n">grid_size</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c"># ~5.5 km</span>

<span class="c"># x,y coordinates for each cell</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="n">x_left_lower_corner</span> <span class="o">+</span> <span class="n">grid_size</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">)</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="n">y_left_lower_corner</span> <span class="o">+</span> <span class="n">grid_size</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_rows</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">)</span>

<span class="c"># x coordinates of the grid cells</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>
<span class="c"># y coordinates of the grid cells</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Data grid&quot;</span>
<span class="k">print</span> <span class="s">&quot;---------&quot;</span>
<span class="k">print</span> <span class="s">&quot;xmin, xmax:&quot;</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span>
<span class="k">print</span> <span class="s">&quot;ymin, ymax:&quot;</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span>
<span class="k">print</span> <span class="s">&quot;grid size:&quot;</span><span class="p">,</span> <span class="n">grid_size</span>
<span class="k">print</span> 

<span class="c">################################################################################</span>
<span class="c"># Load data</span>

<span class="k">print</span> <span class="s">&quot;loading data from disk...&quot;</span>
<span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read coverage grid data; returns array of</span>
<span class="sd">    shape [n_rows, n_cols]. &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c"># Skip header</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">load_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads each of the coverage grids and returns a</span>
<span class="sd">    tensor of shape [14, n_rows, n_cols].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/*.asc&quot;</span> <span class="o">%</span> <span class="n">normpath</span><span class="p">(</span><span class="n">directory</span><span class="p">)):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[:</span><span class="n">fname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>  <span class="c">#np.loadtxt(fpath, skiprows=6, dtype=np.float32)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_coverages</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">coverages</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array : shape = [n_points, 14]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coverages</span><span class="p">[:,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

<span class="n">species2id</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">species_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;samples/alltrain.csv&#39;</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">species2id</span><span class="p">},</span>
                   <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;samples/alltest.csv&#39;</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">species2id</span><span class="p">},</span>
                  <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<span class="c"># Load env variable grids</span>
<span class="n">coverage</span> <span class="o">=</span> <span class="n">load_dir</span><span class="p">(</span><span class="s">&quot;coverages&quot;</span><span class="p">)</span>

<span class="c"># Per species data</span>
<span class="n">bv</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]),</span>
           <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span>
           <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]),</span>
           <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span>
           <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>

<span class="c"># Get features (=coverages)</span>
<span class="n">bv</span><span class="o">.</span><span class="n">train_cover</span> <span class="o">=</span> <span class="n">get_coverages</span><span class="p">(</span><span class="n">bv</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
<span class="n">bv</span><span class="o">.</span><span class="n">test_cover</span> <span class="o">=</span> <span class="n">get_coverages</span><span class="p">(</span><span class="n">bv</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">train_cover</span> <span class="o">=</span> <span class="n">get_coverages</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">test_cover</span> <span class="o">=</span> <span class="n">get_coverages</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Predict the density of the land grid cells</span>
<span class="sd">    under the model `clf`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array : shape [n_rows, n_cols]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="c"># the land points</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coverage</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">coverage</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">std</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Z</span> <span class="o">*=</span> <span class="n">pred</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">Z</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pred</span>
    <span class="k">return</span> <span class="n">Z</span>

<span class="c"># background points (grid coordinates) for evaluation</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">background_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">n_cols</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>

<span class="c"># The grid in x,y coordinates</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c">#basemap = False</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">species</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">bv</span><span class="p">,</span> <span class="n">mm</span><span class="p">]):</span>
    <span class="k">print</span> <span class="s">&quot;_&quot;</span> <span class="o">*</span> <span class="mi">80</span>
    <span class="k">print</span> <span class="s">&quot;Modeling distribution of species &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">species</span><span class="o">.</span><span class="n">name</span>
    <span class="k">print</span>
    <span class="c"># Standardize features</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">train_cover</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">train_cover</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">train_cover_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">train_cover</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>

    <span class="c"># Fit OneClassSVM</span>
    <span class="k">print</span> <span class="s">&quot;fit OneClassSVM ... &quot;</span><span class="p">,</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">OneClassSVM</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;rbf&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_cover_std</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;done. &quot;</span>

    <span class="c"># Plot map of South America</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">basemap</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;plot coastlines using basemap&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">llcrnrlon</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">()</span>
        <span class="c">#m.drawrivers()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;plot coastlines from coverage&quot;</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">coverage</span><span class="p">[</span><span class="mi">2</span><span class="p">,:,:],</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">linestyles</span><span class="o">=</span><span class="s">&quot;solid&quot;</span><span class="p">)</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

    <span class="k">print</span> <span class="s">&quot;predict species distribution&quot;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">Z</span><span class="p">[</span><span class="n">coverage</span><span class="p">[</span><span class="mi">2</span><span class="p">,:,:]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">species</span><span class="o">.</span><span class="n">train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span>
               <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;train&#39;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">species</span><span class="o">.</span><span class="n">test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span>
               <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c"># Compute AUC w.r.t. background points</span>
    <span class="n">pred_background</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">background_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">background_points</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">pred_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">((</span><span class="n">species</span><span class="o">.</span><span class="n">test_cover</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">std</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">pred_test</span><span class="p">,</span> <span class="n">pred_background</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">pred_test</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pred_background</span><span class="o">.</span><span class="n">shape</span><span class="p">)]</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="s">&quot;AUC: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Area under the ROC curve : </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">roc_auc</span>

<span class="k">print</span> <span class="s">&quot;time elapsed: </span><span class="si">%.3f</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
        <p style="text-align: center">This documentation is relative
        to scikits.learn version 0.7.1<p>
        &copy; 2010, scikits.learn developers (BSD License).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2. Design by <a href="http://webylimonada.com">Web y Limonada</a>.
    </div>
  </body>
</html>